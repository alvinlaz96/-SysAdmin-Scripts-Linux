#Bluehost

clear;

unset dsh prt urs usrm mlc line jobd mid i k;

i=0 ;

#Function dsh print dashes.
dsh () { 

echo -e "\n##########################################\n";

};

echo -e "\n\nReport `hostname`\t`date +%d-%m-%Y` `dsh`";

#Function prt doing Main_section stream job changing file permissions.
prt () { 

  echo -e " `cut -d: -f1 $usrm/malware.txt | head -$mlc | xargs -I{} chmod 000 {};`" 

  k=0;

  echo -en "Changing File Permission Of $urs" && 

  while [ "$k" -lt 5 ]; 

    do 

      printf "." sleep 1; 

      sleep 1; 

      k=$(($k+1));

      if [ "$k" -eq 5 ];  

        then 

          echo -e "[OK]"; 

      fi; 

  done;

#Main Section 1 which consists of calculating reported users, linking malware report formats from 2 hgfixlinks and making process of report.
#Enable SOME_LINK If Needs

(
  if [ "$mlc" -lt 50 ] ;
  
   then 
       
     (
      
       echo -e "\n\n`dsh`\n$urs\t`(cpapi2 --user=$urs SubDomain listsubdomains | grep -m1 root | awk '{print $2}')`\t`hostname` `date` `dsh`" &&

       #curl -sk SOME_LINK && cut -d: -f1 $usrm/malware.txt | head -$mlc && 

       echo -e "\n`dsh`" &&

       #curl -sk SOME_LINK && cut -d: -f1 $usrm/malware.txt | head -$mlc ;

     )  >> /ramdisk/mreports.txt;echo;
      
  else 
         
     (
   
        echo -e "\n\n`dsh`\n$urs  `(cpapi2 --user=$urs SubDomain listsubdomains | grep -m1 root | awk '{print $2}')` `hostname` `date` `dsh`" &&

        curl -sk http://hgfix.net/paste/view/raw/e95cfe19 && cut -d: -f1 $usrm/malware.txt | head -50 && 

        echo -e "\n`dsh`" &&

        curl -sk http://hgfix.net/paste/view/raw/e51f2eaf && cut -d: -f1 $usrm/malware.txt | head -50 ;
      
     )  >> /ramdisk/mreports.txt;echo;

  fi;

 )

} &&

#Main Section 2 guiding what to do when malware count goes high and low.
(

  for urs in `cat /ramdisk/musers.txt`; 

    do 

      usrm=`(uapi --user=$urs DomainInfo domains_data format=hash | grep homedir)|head -1 | cut -d : -f2` && 

      mlc=`grep -m1 Infected  $usrm/malware.txt | awk '{print $3}'` && 

     (
     
      if [ "$mlc" -ge 400 ]; 

        then 
        
          prt;
            
          echo -e "\e[1;31m Needs to suspend manually $urs.\e[0m"

      elif [ "$mlc" -lt 400 ] && [ "$mlc" -ge 1 ]; 

          then 
          
          prt;

      elif [ "$mlc" -eq 0 ]; 

          then 
          
          echo -e "\e[1;32m Nothing Suspicious for $urs.\e[0m";

      fi
     ) ; 

  done

) ; 

cat /ramdisk/mreports.txt |hpaste -k;

#rm -vf /ramdisk/musers.txt* /ramdisk/mreports.txt;
